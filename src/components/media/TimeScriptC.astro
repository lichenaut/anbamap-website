<script>
  import { DateTime } from "luxon";

  function convertTimestamps() {
    const mediaList = document.getElementById("mediaList");
    if (!mediaList) {
      return;
    }

    const titleElement = document.querySelector("title");
    if (!titleElement) {
      return;
    }

    let title: string | null = titleElement.textContent;
    if (!title) {
      return;
    }

    if (title.includes("Favorites")) {
      title = title.substring(13);
    } else {
      title = title.substring(6);
    }

    const mediaEntries = Array.from(mediaList.children);
    mediaEntries.forEach((entry) => {
      let timeElement = Array.from(
        entry.querySelectorAll("p.text-gray-600")
      )[0];

      let timeString = timeElement.textContent;
      if (timeString === null) {
        return;
      }

      let time = parseInt(timeString);
      let localTime: string = DateTime.fromSeconds(time)
        .setZone(Intl.DateTimeFormat().resolvedOptions().timeZone)
        .toLocaleString(DateTime.DATETIME_FULL);
      if (!localTime.includes(title.trim())) {
        entry.remove();
        return;
      }

      timeElement.textContent = localTime;
    });
  }

  window.addEventListener("DOMContentLoaded", convertTimestamps);
</script>
